{% extends 'base.html' %}
{% block body %}
{% load static %}
<div class="container mt-5">
    <a href="{% url 'home' %}" class="btn btn-warning rounded-pill px-3" style="width: 100px;">&larr; Voltar</a>
    <h3 class="mb-4 text-center">Painel do Prestador</h3>

    <br>
    <br>
    <h4> OlÃ¡ {{user.first_name}}!</h4>
    <br>
    <!-- Abas de navegaÃ§Ã£o -->
    <ul class="nav nav-tabs mb-4 border-0">

        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tickets">ðŸ“‹ Todos os Tickets</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#historico">ðŸ“š HistÃ³rico de
                ServiÃ§os</button>
        </li>
    </ul>
    <!-- ConteÃºdo das abas -->
    <div class="tab-content border-custom bg-white p-4 rounded shadow-sm">
        <!-- aba 2 -->
        <div class="tab-pane fade" id="tickets">
            {% for ticket in tickets %}
            {% if ticket.status == 'F' %}
            <div class="job-card d-flex border-0 align-items-center justify-content-between mb-4">
                <div class="me-3">
                    <img src="{{ ticket.imagem.url }}" alt="Imagem do serviÃ§o" class="rounded-circle"
                        style="width: 100px; height: 100px;">
                </div>

                <div class="flex-grow-1">
                    <h5>{{ ticket.titulo }}</h5>
                    <p class="mb-3"><i class="fa-solid fa-user-large"></i> <strong>{{ ticket.solicitante }}</strong></p>
                    <p class="mb-3"><i class="fa-solid fa-calendar-days"></i> {{ ticket.dataCriacao|date:"d/m/Y" }}</p>
                    <p class="mb-3"><i class="fa-solid fa-tag"></i> {{ ticket.get_categoria_display }}</p>
                    <p class="mb-3"><i class="fa-solid fa-location-dot"></i> {{ ticket.endereco.logradouro }}
                        {{ticket.endereco.numero }}, {{ ticket.endereco.bairro }} - {{ ticket.endereco.cidade }}
                    </p>
                </div>

                <div class="ms-auto">
                    <a href="{% url 'ticket-orcamento' ticket.id %}" class="btn btn-orange">Ver detalhes</a>
                </div>
            </div>
            {% endif %}
            {% empty %}
            <p class="text-muted">Nenhum ticket disponÃ­vel no momento.</p>
            {% endfor %}
        </div>
        <!-- Aba Historico de ServiÃ§os -->
        <div class="tab-pane fade" id="historico">
            <h5 class="mb-3">HistÃ³rico de Tickets Finalizados</h5>
            {% if historico %}
            {% for ticket in historico %}
            <div class="card mb-3 border-custom bg-claro">
                <div class="card-body d-flex justify-content-between flex-wrap">
                    <!-- Dados do ticket finalizado -->
                    <div>
                        <h5 class="fw-bold">{{ ticket.get_categoria_display }} - {{ ticket.descricao|truncatechars:40 }}
                        </h5>
                        <p><i class="fa-solid fa-calendar-check me-1"></i> Finalizado em: {{
                            ticket.data_encerramento|date:"d/m/Y" }}</p>
                        <p><i class="fa-solid fa-location-dot me-1"></i> {{ ticket.endereco.cidade }} - {{
                            ticket.endereco.bairro }}</p>
                    </div>
                    <!-- Opcional: botÃ£o de detalhes -->
                    <div class="d-flex flex-column justify-content-center">
                        <a href="{% url 'detalhes-pedido' ticket.pk %}" class="btn btn-laranja" style="width: 140px;">
                            Ver detalhes
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="alert alert-secondary">Nenhum ticket finalizado ainda.</div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}